# 网络编程面试知识点

### 简述TCP和UDP。

**UDP**
**无连接**：发送数据前不需要建立连接。
**尽最大努力交付**：发送之后就不管了，丢包了也不会再发送，也不需要接收方接受到后返回信息。
**面向报文**：UDP对应用层交下来的报文，即不合并也不拆分，保留报文的边界，即一次发送一整个报文。
**没有拥塞控制**：不会受到网络拥塞的影响，对实时应用很重要。
**支持所有通信方式**：一对一、一对多、多对一、多对多。
**首部开销小**：只有8个字节（8位二进制数为一字节）。

TCP
**面向连接**：使用tcp之前必须先建立tcp连接，传输数据完毕，必须释放已经建立的tcp连接，就像打电话一样。
**提供可靠交付**：通过tcp连接传输数据，无差错、不丢失、不重复并且按序到达。
**每一条tcp连接都有两个端点**：只能点对点的一对一通信。
**面向字节流**：tcp会把应用层交下来的一个数据块，看成一连串的无结构的字节流。

### 简述TCP的三次握手和四次挥手的过程？

建立连接的过程：

第一次握手：客户进程A首先创建传输控制块TCB，然后向服务器进程B发出连接请求报文段。此时，客户进程A进入SYN-SENT（同步已发送）状态。

第二次握手：B收到连接请求报文段后，如同意建立连接，则向A发送确认报文段。此时，B进入SYN-RCVD（同步收到）状态

第三次握手：A收到B的确认报文段后，也要向B给出确认报文段。此时，A进入ESTABLISHED（已建立连接）状态，当B收到A的确认报文段后，也进入ESTABLISHED（已建立连接）状态，TCP连接完成建立。

中断连接的过程：

第一次挥手：A先向B发出连接释放报文段，并停止再发送数据，主动关闭TCP连接，进入FIN-WAIT-1（终止等待1）状态，等待B的确认。

第二次挥手：B收到连接释放报文段后，随即发出确认报文段，B进入CLOSE-WAIT（关闭等待）状态，此时的TCP处于半关闭状态。A收到B的确认报文后，进入FIN-WAIT-2（终止等待2）状态，等待B之后发出的连接释放报文段。

第三次挥手：B将最后的数据发送完毕后，就向A发送连接释放报文，此时，B就进入了LAST-ACK（最后确认）状态，等待A的确认。

第四次挥手：A收到B的连接释放报文段后，对此发出确认报文段，此时，A就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，A必须经过2∗ *∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。而B只要收到了A发出的确认报文，就立即进入CLOSED状态。

### 为什么A还要向B发送一次确认呢？可以二次握手吗？

答：主要为了防止已失效的连接请求报文段突然又传送到了B，因而产生错误。如A发出连接请求，但因连接请求报文丢失而未收到确认，于是A再重传一次连接请求。后来收到了确认，建立了连接。数据传输完毕后，就释放了连接，A发出了两个连接请求报文段，其中第一个丢失，第二个到达了B，但是第一个丢失的报文段只是在某些网络结点长时间滞留了，延误到连接释放以后的某个时间才到达B，此时B误认为A又发出一次新的连接请求，于是就向A发出确认报文段，同意建立连接，不采用三次握手，只要B发出确认，就建立新的连接了，此时A不理睬B的确认且不发送数据，则B一致等待A发送数据，浪费资源。

### 为什么连接的时候是三次握手，关闭的时候却是四次握手？

答：因为在建立连接的过程中，B收到A的连接请求报文后，B可以将连接请求报文和确认报文一起发送给A。而中断连接过程中，A发送连接中断请求报文后，只表示A不再发送数据，但是A可以继续接受数据，B可以继续发送数据，所以B收到A的连接中断请求报文后只能发送确认报文，在B发送数据完毕后才会发送连接中断请求报文给A。所以握手是三次，挥手是四次。

### 为什么A在TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？

答：虽然四个报文都发送完毕，A可以直接进入CLOSE状态了，因为有可能最后一个ACK丢失。B如果在一个MSL内没收到A的最后一个ACK，就会又发送连接中断请求报文给A，所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。

### TCP是如何保证传输的可靠性的？

校验和：发送的数据包的二进制相加然后取反，目的是检测数据在传输过程中的任何变化。如果收到段的检验和有差错，TCP将丢弃这个报文段和不确认收到此报文段。 

确认应答+序列号：TCP给发送的每一个包进行编号，接收方对数据包进行排序，把有序数据传送给应用层。 TCP传输的过程中，每次接收方收到数据后，都会对传输方进行确认应答，并且确认报文当中带有对应的确认序列号。

超时重传：当TCP发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段。 

连接管理：三次握手与四次挥手的过程，提供可靠的连接管理。

流量控制：TCP连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP使用的流量控制协议是可变大小的滑动窗口协议。

拥塞控制：当网络拥塞时，减少数据的发送。

### http中post和get的区别？

http是应用层协议，从传输层来看都是使用tcp协议，post和get没有什么区别。

http协议制定的初衷，GET、POST、PUT、DELETE对应查改增删 4个操作。

1、get：get请求的数据会附在url之后（也就是把数据放置在http协议头中），以?分割URL和传输数据，参数之间以&相连，如果数据是英文字母或数字，原样发送，如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密。当然get也可以把提交的数据则放置在是http包体中。

get请求url可以被缓存在浏览器历史和web服务器日志里面。不同浏览器对整个get请求的url长度会有限制。

2、post：post把提交的数据则放置在是http包的包体中。post请求url不可以被缓存。post数据大小没有限制。

但是如果被抓了包，post和get的数据一样都是明文的了，所以https该用还是得用，该加密的数据还是要加密。但是post要比get要安全一些。



语义角度：

get是获取资源，安全的，幂等的，可缓存的。

Post是提交资源，不安全的，非幂等的，不可缓存的。

安全：不会引起服务器的数据、状态的变化。

幂等：同一个请求，一次执行和多次执行效果完全相同。



